<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Contributing a Municipal Scraper &mdash; Municipal Scrapers Contributor&#39;s Guide 0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Municipal Scrapers Contributor&#39;s Guide 0.0 documentation" href="index.html" />
    <link rel="prev" title="Municipal Scrapers Contributor’s Guide" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="index.html" title="Municipal Scrapers Contributor’s Guide"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Municipal Scrapers Contributor&#39;s Guide 0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="contributing-a-municipal-scraper">
<h1>Contributing a Municipal Scraper<a class="headerlink" href="#contributing-a-municipal-scraper" title="Permalink to this headline">¶</a></h1>
<p>This document is meant to provide a tutorial-like overview of the steps toward contributing a munipal scraper to the Open Civic Data project.</p>
<p>The green arrows designate &#8220;more info&#8221; links leading to advanced sections about the described task.</p>
<div class="section" id="setting-up-your-environment">
<h2>Setting Up Your Environment<a class="headerlink" href="#setting-up-your-environment" title="Permalink to this headline">¶</a></h2>
<p>The recommended way to manage dependencies in python is with <a class="reference external" href="https://pypi.python.org/pypi/virtualenv">virtualenv</a>. If virtualenv is new territory for you, go there first and get set up, then check out <a class="reference external" href="http://virtualenvwrapper.readthedocs.org/en/latest/">virtualenvwrapper</a> for extra convenience in setting up, activating, deactivating, and tearing down virtualenvs.</p>
<p>To get started on your first scraper, create a new virtualenv to manage the dependencies for your code.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> ~/.virtualenvs
<span class="nv">$ </span>virtualenv municipal-scrapers

<span class="c"># Next activate your virtualenv.</span>
<span class="nv">$ </span><span class="nb">source </span>municipal-scrapers/bin/activate

<span class="c"># Next, create a directory to hold your scrapers. (Don&#39;t be silly, of course you&#39;ll want to write more than one.)</span>
<span class="nv">$ </span>mkdir ~/projects/municipal scrapers
<span class="nv">$ </span><span class="nb">cd</span> !:1
</pre></div>
</div>
<p>Note that you can write scrapers in python 2.7 or python 3.3 or higher.
To create a virtualenv using a version of python other than your system version, use the -p command line flag:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>virtualenv -p<span class="sb">`</span>which python3.3<span class="sb">`</span> municipal-scrapers
</pre></div>
</div>
<p>And for the record, if you&#8217;re using <a class="reference external" href="http://virtualenvwrapper.readthedocs.org/en/latest/">virtualenvwrapper</a>, the previous four steps be abbreviated to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>mkproject municipal-scrapers
</pre></div>
</div>
<p>Finally, install <a class="reference external" href="https://github.com/opencivicdata/pupa">pupa</a>, the scraper framework we&#8217;ll be using to scrape municipal data.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>pip install -e git+git@github.com:opencivicdata/pupa.git#egg<span class="o">=</span>Package
</pre></div>
</div>
</div>
<div class="section" id="creating-a-new-scraper">
<h2>Creating a New Scraper<a class="headerlink" href="#creating-a-new-scraper" title="Permalink to this headline">¶</a></h2>
<p>Now you&#8217;re ready to start a new scraper! To copy a skeleton project into a new scraper directory, use pupa&#8217;s init command. Let&#8217;s create a new scraper for Albuquerque:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>pupa init albuquerque
</pre></div>
</div>
<p>Pupa will copy the skeleton project into a new albuquerque directory with the following structure.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>tree albuquerque/
albuquerque/
├── __init__.py
└── people.py
</pre></div>
</div>
<p>Open up the new <tt class="file docutils literal"><span class="pre">albuquerque/__init__.py</span></tt> file and check out it&#8217;s contents. It will look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pupa.scrape</span> <span class="kn">import</span> <span class="n">Jurisdiction</span>

<span class="kn">from</span> <span class="nn">.people</span> <span class="kn">import</span> <span class="n">PersonScraper</span>


<span class="k">class</span> <span class="nc">Example</span><span class="p">(</span><span class="n">Jurisdiction</span><span class="p">):</span>
    <span class="n">jurisdiction_id</span> <span class="o">=</span> <span class="s">&#39;ocd-jurisdiction/country:us/state:ex/place:example&#39;</span>

    <span class="k">def</span> <span class="nf">get_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Example&#39;</span><span class="p">,</span>
            <span class="s">&#39;legislature_name&#39;</span><span class="p">:</span> <span class="s">&#39;Example Legislature&#39;</span><span class="p">,</span>
            <span class="s">&#39;legislature_url&#39;</span><span class="p">:</span> <span class="s">&#39;http://example.com&#39;</span><span class="p">,</span>
            <span class="s">&#39;terms&#39;</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;2013-2014&#39;</span><span class="p">,</span>
                <span class="s">&#39;sessions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;2013&#39;</span><span class="p">],</span>
                <span class="s">&#39;start_year&#39;</span><span class="p">:</span> <span class="mi">2013</span><span class="p">,</span>
                <span class="s">&#39;end_year&#39;</span><span class="p">:</span> <span class="mi">2014</span>
                <span class="p">}],</span>
            <span class="s">&#39;provides&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;people&#39;</span><span class="p">],</span>
            <span class="s">&#39;parties&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Independent&#39;</span> <span class="p">},</span>
                <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Green&#39;</span> <span class="p">},</span>
                <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Bull-Moose&#39;</span><span class="p">}</span>
               <span class="p">],</span>
            <span class="s">&#39;session_details&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&#39;2013&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;_scraped_name&#39;</span><span class="p">:</span> <span class="s">&#39;2013&#39;</span><span class="p">}</span>
                <span class="p">},</span>
            <span class="s">&#39;feature_flags&#39;</span><span class="p">:</span> <span class="p">[],</span>
               <span class="p">}</span>

    <span class="k">def</span> <span class="nf">get_scraper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">term</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">scraper_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">scraper_type</span> <span class="o">==</span> <span class="s">&#39;people&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PersonScraper</span>

    <span class="k">def</span> <span class="nf">scrape_session_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">&#39;2013&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>This file contains a single subclass of a Jurisdiction base class. The jurisdiction class represents the municipality we&#8217;re scraping information for, and is the place we&#8217;ll store the metadata required during the scrape. To get started, all we have to do is edit the metadata on this class to be specific to Albuquerque.</p>
<p>Notice also the <cite>get_scraper</cite> function. Your scraper needs to implement this simple function to define what scraper gets used given a <cite>term</cite>, <cite>session</cite>, and <cite>scraper_type</cite>. <cite>scraper_type</cite> will be a string equal to &#8216;people&#8217;, &#8216;bills&#8217;, or &#8216;events&#8217;. As you can see, the default implementation of this function simply returns the <cite>PeopleScraper</cite> if the <cite>scraper_type</cite> is &#8216;people&#8217;, but this function can easily scale up to supply a different people scraper for different terms or even sessions, which might be necessary if the municipality rolls out a new website for a new term, requiring a new scraper.</p>
<p>This is all well and good, but now let&#8217;s hack this example file to customize it to work for Albuquerque.</p>
</div>
<div class="section" id="edit-the-jurisdiction-s-metadata">
<h2>Edit the Jurisdiction&#8217;s Metadata<a class="headerlink" href="#edit-the-jurisdiction-s-metadata" title="Permalink to this headline">¶</a></h2>
<p>Take a look at the Albuquerque-specific changes below:</p>
<p>Let&#8217;s go over the changes made above one at a time.</p>
<ul>
<li><p class="first">Change the <cite>jurisdiction_id</cite>:</p>
<p>The first edit changes the example <cite>jurisdiction_id</cite> to make it specific to Albuquerque, New Mexico, by setting the state abbreviation to &#8220;nm&#8221; and the place name to &#8220;albuquerque,&#8221; followed by a slash and the word &#8220;council.&#8221; Adding &#8220;council&#8221; at the end of the <cite>jurisdiction_id</cite> is simply a convention this project uses when scraping information about a city council. (You can also read more about <a class="reference internal" href="ocdids.html#ocdid"><em>OCD Identifiers</em></a>.)</p>
</li>
<li><p class="first">Change the Basic Jurisdiction Details:</p>
<p>Next notice that we changed <cite>name</cite>, <cite>legislature_name</cite>, <cite>legislature_url</cite>, all of which are pretty self-explanatory. The <cite>legislature_url</cite> is the url of the Albuquerque City Council website we&#8217;ll be scraping.</p>
</li>
<li><p class="first">Add the appropriate values for Albuquerque City Council terms and sessions:</p>
<p>This is the only really tricky part of starting a new jurisdiction. The <cite>term</cite> is the length of time that officials in the Albuquerque City Council hold office. Sometimes this is straight-forward, and few minutes of strategic googling reveals that the council members all serve predictable two-year terms and come up for election every even numbered year, for example. But some jurisdictions have staggered elections in which only some of the council members participate in a given election, while others will be up for election during a later election.</p>
<p>The rule for choosing the <cite>term</cite> value is actually simple: if the municipality has a uniform term, use that; if it has staggered terms, the term length is the length of time in between elections. So if council members serve two-year terms, but each year staggered elections are held in which only half of the council members are up for re-election, the term length is one year.</p>
<p>As for the value you&#8217;ll enter into the metadata as the term&#8217;s <cite>name</cite>, by convention the project uses a year range, like &#8216;2013-2014&#8217;.</p>
<p>How does one go about locating this information? An excellent place to look is in the relevant municipality&#8217;s town charter or equivalent document. In this case, I found Albuquerque&#8217;s town charter by simply googling &#8220;Albuquerque charter&#8221; and clicking the first result, which was a <a class="reference external" href="http://www.cabq.gov/council/documents/charter-review-task-force/city_charter.pdf">PDF of the charter</a> located on the town&#8217;s official .gov website: <a class="reference external" href="http://www.cabq.gov/">http://www.cabq.gov/</a>. Perusing the table of contents, I noticed a section entitled &#8220;Terms of Office&#8221; in Article IV, section 4 of the charter. Here&#8217;s what it says:</p>
<blockquote>
<div><p>&#8220;The terms of the office of a Councilor, unless sooner recalled or removed, shall begin on December 1st of the year of election and be four years or until a successor is duly elected and qualified. The Councillors may succeed themselves in office. The terms of office of Councillors shall be staggered with four or five districted Councillors elected every two years.&#8221;</p>
</div></blockquote>
<p>Aha. In Albuquerque, each council member serves a four year term, and staggered elections are held every two years. So our term length will be two years. The final step is to figure out the start year in the range we&#8217;ll use as the <cite>term</cite> value, and to do that, we&#8217;ll again turn to Albuquerque&#8217;s official website. This time, some quick research took me to the city&#8217;s <a class="reference external" href="http://www.cabq.gov/voting-elections/candidate-information/2013-general-election-information/2013-general-election-calendar">2013 General Election Calendar</a>. So our term will begin in 2013 with a two-year duration, making our term <cite>name</cite> value &#8216;2013-2015&#8217;.</p>
<p>Accordingly, in the diff above we changed the name of the term to &#8216;2013-2015&#8217;, added the start and end years of the term as integers, and added the current legislative session of &#8216;2013&#8217; to the term&#8217;s &#8216;sessions&#8217; list, which will expand in the future to include the 2014 and 2015 sessions.</p>
</li>
<li><p class="first">Delete the <cite>parties</cite> information:</p>
<p>This change isn&#8217;t strictly necessary, but I couldn&#8217;t easily located information about party affiliation among Albuquerque council members, so I deleted this dictionary to avoid having inaccurate information in the scraper&#8217;s metadata.</p>
</li>
</ul>
</div>
<div class="section" id="get-up-and-stretch">
<h2>Get Up and Stretch!<a class="headerlink" href="#get-up-and-stretch" title="Permalink to this headline">¶</a></h2>
<p>We&#8217;re done editing the metadata for Albuquerque, and next we&#8217;ll write the people scraper. Go get a refill, then continue on to <a class="reference internal" href="people.html#people"><em>Contributing a Municipal Person Scraper</em></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Contributing a Municipal Scraper</a><ul>
<li><a class="reference internal" href="#setting-up-your-environment">Setting Up Your Environment</a></li>
<li><a class="reference internal" href="#creating-a-new-scraper">Creating a New Scraper</a></li>
<li><a class="reference internal" href="#edit-the-jurisdiction-s-metadata">Edit the Jurisdiction&#8217;s Metadata</a></li>
<li><a class="reference internal" href="#get-up-and-stretch">Get Up and Stretch!</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Municipal Scrapers Contributor&#8217;s Guide</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/intro.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="index.html" title="Municipal Scrapers Contributor’s Guide"
             >previous</a> |</li>
        <li><a href="index.html">Municipal Scrapers Contributor&#39;s Guide 0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Thom Neale.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>